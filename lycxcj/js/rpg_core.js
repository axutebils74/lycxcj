function JsExtensions(){throw new Error("This is not a class")}function Utils(){throw new Error("This is a static class")}function Point(){this.initialize.apply(this,arguments)}function Rectangle(){this.initialize.apply(this,arguments)}function Bitmap(){this.initialize.apply(this,arguments)}function Graphics(){throw new Error("This is a static class")}function Input(){throw new Error("This is a static class")}function TouchInput(){throw new Error("This is a static class")}function Sprite(){this.initialize.apply(this,arguments)}function Tilemap(){this.initialize.apply(this,arguments)}function TilingSprite(){this.initialize.apply(this,arguments)}function ScreenSprite(){this.initialize.apply(this,arguments)}function Window(){this.initialize.apply(this,arguments)}function WindowLayer(){this.initialize.apply(this,arguments)}function Weather(){this.initialize.apply(this,arguments)}function ToneFilter(){PIXI.AbstractFilter.call(this),this.initialize.apply(this,arguments)}function ToneSprite(){this.initialize.apply(this,arguments)}function Stage(){this.initialize.apply(this,arguments)}function WebAudio(){this.initialize.apply(this,arguments)}function Html5Audio(){throw new Error("This is a static class")}function JsonEx(){throw new Error("This is a static class")}Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Number.prototype.mod=function(t){return(this%t+t)%t},String.prototype.format=function(){var t=arguments;return this.replace(/%([0-9]+)/g,(function(e,i){return t[Number(i)-1]}))},String.prototype.padZero=function(t){for(var e=this;e.length<t;)e="0"+e;return e},Number.prototype.padZero=function(t){return String(this).padZero(t)},Array.prototype.equals=function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.length;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!==t[e])return!1;return!0},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.contains=function(t){return this.indexOf(t)>=0},String.prototype.contains=function(t){return this.indexOf(t)>=0},Math.randomInt=function(t){return Math.floor(t*Math.random())},Utils.RPGMAKER_NAME="MV",Utils.isOptionValid=function(t){return location.search.slice(1).split("&").contains(t)},Utils.isNwjs=function(){return"function"==typeof require&&"object"==typeof process},Utils.isMobileDevice=function(){return!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)},Utils.isMobileSafari=function(){var t=navigator.userAgent;return!(!t.match(/iPhone|iPad|iPod/)||!t.match(/AppleWebKit/)||t.match("CriOS"))},Utils.isAndroidChrome=function(){var t=navigator.userAgent;return!(!t.match(/Android/)||!t.match(/Chrome/))},Utils.canReadGameFiles=function(){var t=document.getElementsByTagName("script"),e=t[t.length-1],i=new XMLHttpRequest;try{return i.open("GET",e.src),i.overrideMimeType("text/javascript"),i.send(),!0}catch(t){return!1}},Utils.rgbToCssColor=function(t,e,i){return"rgb("+(t=Math.round(t))+","+(e=Math.round(e))+","+(i=Math.round(i))+")"},Point.prototype=Object.create(PIXI.Point.prototype),Point.prototype.constructor=Point,Point.prototype.initialize=function(t,e){PIXI.Point.call(this,t,e)},Rectangle.prototype=Object.create(PIXI.Rectangle.prototype),Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.initialize=function(t,e,i,n){PIXI.Rectangle.call(this,t,e,i,n)},Rectangle.emptyRectangle=new Rectangle(0,0,0,0),Bitmap.prototype.initialize=function(t,e){this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._canvas.width=Math.max(t||0,1),this._canvas.height=Math.max(e||0,1),this._baseTexture=new PIXI.BaseTexture(this._canvas),this._baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._isLoading=!1,this._hasError=!1,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4},Bitmap.load=function(t){var e=new Bitmap;return e._image=new Image,e._image.src=t,e._image.onload=Bitmap.prototype._onLoad.bind(e),e._image.onerror=Bitmap.prototype._onError.bind(e),e._url=t,e._isLoading=!0,e},Bitmap.snap=function(t){var e=Graphics.width,i=Graphics.height,n=new Bitmap(e,i),s=n._context,r=new PIXI.RenderTexture(e,i);if(t&&(r.render(t),t.worldTransform.identity()),Graphics.isWebGL()){var o=r.renderer.gl,a=new Uint8Array(4*e*i);o.bindFramebuffer(o.FRAMEBUFFER,r.textureBuffer.frameBuffer),o.readPixels(0,0,e,i,o.RGBA,o.UNSIGNED_BYTE,a),o.bindFramebuffer(o.FRAMEBUFFER,null);var h=s.getImageData(0,0,e,i);h.data.set(a),s.putImageData(h,0,0)}else s.drawImage(r.textureBuffer.canvas,0,0);return n._setDirty(),n},Bitmap.prototype.isReady=function(){return!this._isLoading},Bitmap.prototype.isError=function(){return this._hasError},Object.defineProperty(Bitmap.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(Bitmap.prototype,"baseTexture",{get:function(){return this._baseTexture},configurable:!0}),Object.defineProperty(Bitmap.prototype,"canvas",{get:function(){return this._canvas},configurable:!0}),Object.defineProperty(Bitmap.prototype,"context",{get:function(){return this._context},configurable:!0}),Object.defineProperty(Bitmap.prototype,"width",{get:function(){return this._isLoading?0:this._canvas.width},configurable:!0}),Object.defineProperty(Bitmap.prototype,"height",{get:function(){return this._isLoading?0:this._canvas.height},configurable:!0}),Object.defineProperty(Bitmap.prototype,"rect",{get:function(){return new Rectangle(0,0,this.width,this.height)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth!==t&&(this._smooth=t,this._smooth?this._baseTexture.scaleMode=PIXI.scaleModes.LINEAR:this._baseTexture.scaleMode=PIXI.scaleModes.NEAREST)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"paintOpacity",{get:function(){return this._paintOpacity},set:function(t){this._paintOpacity!==t&&(this._paintOpacity=t,this._context.globalAlpha=this._paintOpacity/255)},configurable:!0}),Bitmap.prototype.resize=function(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._canvas.width=t,this._canvas.height=e,this._baseTexture.width=t,this._baseTexture.height=e},Bitmap.prototype.blt=function(t,e,i,n,s,r,o,a,h){a=a||n,h=h||s,e>=0&&i>=0&&n>0&&s>0&&a>0&&h>0&&e+n<=t.width&&i+s<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._canvas,e,i,n,s,r,o,a,h),this._setDirty())},Bitmap.prototype.getPixel=function(t,e){for(var i=this._context.getImageData(t,e,1,1).data,n="#",s=0;s<3;s++)n+=i[s].toString(16).padZero(2);return n},Bitmap.prototype.getAlphaPixel=function(t,e){return this._context.getImageData(t,e,1,1).data[3]},Bitmap.prototype.clearRect=function(t,e,i,n){this._context.clearRect(t,e,i,n),this._setDirty()},Bitmap.prototype.clear=function(){this.clearRect(0,0,this.width,this.height)},Bitmap.prototype.fillRect=function(t,e,i,n,s){var r=this._context;r.save(),r.fillStyle=s,r.fillRect(t,e,i,n),r.restore(),this._setDirty()},Bitmap.prototype.fillAll=function(t){this.fillRect(0,0,this.width,this.height,t)},Bitmap.prototype.gradientFillRect=function(t,e,i,n,s,r,o){var a,h=this._context;(a=o?h.createLinearGradient(t,e,t,e+n):h.createLinearGradient(t,e,t+i,e)).addColorStop(0,s),a.addColorStop(1,r),h.save(),h.fillStyle=a,h.fillRect(t,e,i,n),h.restore(),this._setDirty()},Bitmap.prototype.drawCircle=function(t,e,i,n){var s=this._context;s.save(),s.fillStyle=n,s.beginPath(),s.arc(t,e,i,0,2*Math.PI,!1),s.fill(),s.restore(),this._setDirty()},Bitmap.prototype.drawText=function(t,e,i,n,s,r){if(void 0!==t){var o=e,a=i+s-(s-.7*this.fontSize)/2,h=this._context,p=h.globalAlpha;n=n||4294967295,"center"===r&&(o+=n/2),"right"===r&&(o+=n),h.save(),h.font=this._makeFontNameText(),h.textAlign=r,h.textBaseline="alphabetic",h.globalAlpha=1,this._drawTextOutline(t,o,a,n),h.globalAlpha=p,this._drawTextBody(t,o,a,n),h.restore(),this._setDirty()}},Bitmap.prototype.measureTextWidth=function(t){var e=this._context;e.save(),e.font=this._makeFontNameText();var i=e.measureText(t).width;return e.restore(),i},Bitmap.prototype.adjustTone=function(t,e,i){if((t||e||i)&&this.width>0&&this.height>0){for(var n=this._context,s=n.getImageData(0,0,this.width,this.height),r=s.data,o=0;o<r.length;o+=4)r[o+0]+=t,r[o+1]+=e,r[o+2]+=i;n.putImageData(s,0,0),this._setDirty()}},Bitmap.prototype.rotateHue=function(t){function e(t,e,i){var n=Math.min(t,e,i),s=Math.max(t,e,i),r=0,o=0,a=(n+s)/2,h=s-n;return h>0&&(r=t===s?((e-i)/h+6)%6*60:e===s?60*((i-t)/h+2):60*((t-e)/h+4),o=h/(255-Math.abs(2*a-255))),[r,o,a]}function i(t,e,i){var n=(255-Math.abs(2*i-255))*e,s=i-n/2,r=n+s,o=n*(1-Math.abs(t/60%2-1))+s;return t<60?[r,o,s]:t<120?[o,r,s]:t<180?[s,r,o]:t<240?[s,o,r]:t<300?[o,s,r]:[r,s,o]}if(t&&this.width>0&&this.height>0){t=(t%360+360)%360;for(var n=this._context,s=n.getImageData(0,0,this.width,this.height),r=s.data,o=0;o<r.length;o+=4){var a=e(r[o+0],r[o+1],r[o+2]),h=i((a[0]+t)%360,a[1],a[2]);r[o+0]=h[0],r[o+1]=h[1],r[o+2]=h[2]}n.putImageData(s,0,0),this._setDirty()}},Bitmap.prototype.blur=function(){for(var t=0;t<2;t++){var e=this.width,i=this.height,n=this._canvas,s=this._context,r=document.createElement("canvas"),o=r.getContext("2d");r.width=e+2,r.height=i+2,o.drawImage(n,0,0,e,i,1,1,e,i),o.drawImage(n,0,0,e,1,1,0,e,1),o.drawImage(n,0,0,1,i,0,1,1,i),o.drawImage(n,0,i-1,e,1,1,i+1,e,1),o.drawImage(n,e-1,0,1,i,e+1,1,1,i),s.save(),s.fillStyle="black",s.fillRect(0,0,e,i),s.globalCompositeOperation="lighter",s.globalAlpha=1/9;for(var a=0;a<3;a++)for(var h=0;h<3;h++)s.drawImage(r,h,a,e,i,0,0,e,i);s.restore()}this._setDirty()},Bitmap.prototype.addLoadListener=function(t){this._isLoading?this._loadListeners.push(t):t()},Bitmap.prototype._makeFontNameText=function(){return(this.fontItalic?"Italic ":"")+this.fontSize+"px "+this.fontFace},Bitmap.prototype._drawTextOutline=function(t,e,i,n){var s=this._context;s.strokeStyle=this.outlineColor,s.lineWidth=this.outlineWidth,s.lineJoin="round",s.strokeText(t,e,i,n)},Bitmap.prototype._drawTextBody=function(t,e,i,n){var s=this._context;s.fillStyle=this.textColor,s.fillText(t,e,i,n)},Bitmap.prototype._onLoad=function(){this._isLoading=!1,this.resize(this._image.width,this._image.height),this._context.drawImage(this._image,0,0),this._setDirty(),this._callLoadListeners()},Bitmap.prototype._callLoadListeners=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()()}},Bitmap.prototype._onError=function(){this._hasError=!0},Bitmap.prototype._setDirty=function(){this._baseTexture.dirty()},Graphics.initialize=function(t,e,i){this._width=t||800,this._height=e||600,this._rendererType=i||"auto",this._boxWidth=this._width,this._boxHeight=this._height,this._scale=1,this._realScale=1,this._errorPrinter=null,this._canvas=null,this._video=null,this._upperCanvas=null,this._renderer=null,this._fpsMeter=null,this._modeBox=null,this._skipCount=0,this._maxSkip=3,this._rendered=!1,this._loadingImage=null,this._loadingCount=0,this._fpsMeterToggled=!1,this._stretchEnabled=this._defaultStretchMode(),this._canUseDifferenceBlend=!1,this._canUseSaturationBlend=!1,this._hiddenCanvas=null,this._testCanvasBlendModes(),this._modifyExistingElements(),this._updateRealScale(),this._createAllElements(),this._disableTextSelection(),this._disableContextMenu(),this._setupEventHandlers()},Graphics.frameCount=0,Graphics.BLEND_NORMAL=0,Graphics.BLEND_ADD=1,Graphics.BLEND_MULTIPLY=2,Graphics.BLEND_SCREEN=3,Graphics.tickStart=function(){this._fpsMeter&&this._fpsMeter.tickStart()},Graphics.tickEnd=function(){this._fpsMeter&&this._rendered&&this._fpsMeter.tick()},Graphics.render=function(t){if(0===this._skipCount){var e=Date.now();t&&this._renderer.render(t);var i=Date.now()-e;this._skipCount=Math.min(Math.floor(i/15),this._maxSkip),this._rendered=!0}else this._skipCount--,this._rendered=!1;this.frameCount++},Graphics.isWebGL=function(){return this._renderer&&this._renderer.type===PIXI.WEBGL_RENDERER},Graphics.hasWebGL=function(){try{var t=document.createElement("canvas");return!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},Graphics.canUseDifferenceBlend=function(){return this._canUseDifferenceBlend},Graphics.canUseSaturationBlend=function(){return this._canUseSaturationBlend},Graphics.setLoadingImage=function(t){this._loadingImage=new Image,this._loadingImage.src=t},Graphics.startLoading=function(){this._loadingCount=0},Graphics.updateLoading=function(){this._loadingCount++,this._paintUpperCanvas(),this._upperCanvas.style.opacity=1},Graphics.endLoading=function(){this._clearUpperCanvas(),this._upperCanvas.style.opacity=0},Graphics.printError=function(t,e){this._errorPrinter&&(this._errorPrinter.innerHTML=this._makeErrorHtml(t,e)),this._applyCanvasFilter(),this._clearUpperCanvas()},Graphics.showFps=function(){this._fpsMeter&&(this._fpsMeter.show(),this._modeBox.style.opacity=1)},Graphics.hideFps=function(){this._fpsMeter&&(this._fpsMeter.hide(),this._modeBox.style.opacity=0)},Graphics.loadFont=function(t,e){var i=document.createElement("style"),n=document.getElementsByTagName("head"),s='@font-face { font-family: "'+t+'"; src: url("'+e+'"); }';i.type="text/css",n.item(0).appendChild(i),i.sheet.insertRule(s,0),this._createFontLoader(t)},Graphics.isFontLoaded=function(t){this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));var e,i=this._hiddenCanvas.getContext("2d"),n="abcdefghijklmnopqrstuvwxyz";return i.font="40px "+t+", sans-serif",e=i.measureText(n).width,i.font="40px sans-serif",e!==i.measureText(n).width},Graphics.playVideo=function(t){this._video.src=t,this._video.onloadeddata=this._onVideoLoad.bind(this),this._video.onerror=this._onVideoError.bind(this),this._video.onended=this._onVideoEnd.bind(this),this._video.load()},Graphics.isVideoPlaying=function(){return this._video&&this._isVideoVisible()},Graphics.canPlayVideoType=function(t){return this._video&&this._video.canPlayType(t)},Graphics.pageToCanvasX=function(t){if(this._canvas){var e=this._canvas.offsetLeft;return Math.round((t-e)/this._realScale)}return 0},Graphics.pageToCanvasY=function(t){if(this._canvas){var e=this._canvas.offsetTop;return Math.round((t-e)/this._realScale)}return 0},Graphics.isInsideCanvas=function(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height},Object.defineProperty(Graphics,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"boxWidth",{get:function(){return this._boxWidth},set:function(t){this._boxWidth=t},configurable:!0}),Object.defineProperty(Graphics,"boxHeight",{get:function(){return this._boxHeight},set:function(t){this._boxHeight=t},configurable:!0}),Object.defineProperty(Graphics,"scale",{get:function(){return this._scale},set:function(t){this._scale!==t&&(this._scale=t,this._updateAllElements())},configurable:!0}),Graphics._createAllElements=function(){this._createErrorPrinter(),this._createCanvas(),this._createVideo(),this._createUpperCanvas(),this._createRenderer(),this._createFPSMeter(),this._createModeBox(),this._createGameFontLoader()},Graphics._updateAllElements=function(){this._updateRealScale(),this._updateErrorPrinter(),this._updateCanvas(),this._updateVideo(),this._updateUpperCanvas(),this._updateRenderer(),this._paintUpperCanvas()},Graphics._updateRealScale=function(){if(this._stretchEnabled){var t=window.innerWidth/this._width,e=window.innerHeight/this._height;this._realScale=Math.min(t,e)}else this._realScale=this._scale},Graphics._makeErrorHtml=function(t,e){return'<font color="yellow"><b>'+t+'</b></font><br><font color="white">'+e+"</font><br>"},Graphics._defaultStretchMode=function(){return Utils.isNwjs()||Utils.isMobileDevice()},Graphics._testCanvasBlendModes=function(){var t,e,i,n;(t=document.createElement("canvas")).width=1,t.height=1,(e=t.getContext("2d")).globalCompositeOperation="source-over",e.fillStyle="white",e.fillRect(0,0,1,1),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,1,1),i=e.getImageData(0,0,1,1),e.globalCompositeOperation="source-over",e.fillStyle="black",e.fillRect(0,0,1,1),e.globalCompositeOperation="saturation",e.fillStyle="white",e.fillRect(0,0,1,1),n=e.getImageData(0,0,1,1),this._canUseDifferenceBlend=0===i.data[0],this._canUseSaturationBlend=0===n.data[0]},Graphics._modifyExistingElements=function(){for(var t=document.getElementsByTagName("*"),e=0;e<t.length;e++)t[e].style.zIndex>0&&(t[e].style.zIndex=0)},Graphics._createErrorPrinter=function(){this._errorPrinter=document.createElement("p"),this._errorPrinter.id="ErrorPrinter",this._updateErrorPrinter(),document.body.appendChild(this._errorPrinter)},Graphics._updateErrorPrinter=function(){this._errorPrinter.width=.9*this._width,this._errorPrinter.height=40,this._errorPrinter.style.textAlign="center",this._errorPrinter.style.textShadow="1px 1px 3px #000",this._errorPrinter.style.fontSize="20px",this._errorPrinter.style.zIndex=99,this._centerElement(this._errorPrinter)},Graphics._createCanvas=function(){this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this._updateCanvas(),document.body.appendChild(this._canvas)},Graphics._updateCanvas=function(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.zIndex=1,this._centerElement(this._canvas)},Graphics._createVideo=function(){this._video=document.createElement("video"),this._video.id="GameVideo",this._video.style.opacity=0,this._updateVideo(),document.body.appendChild(this._video)},Graphics._updateVideo=function(){this._video.width=this._width,this._video.height=this._height,this._video.style.zIndex=2,this._centerElement(this._video)},Graphics._createUpperCanvas=function(){this._upperCanvas=document.createElement("canvas"),this._upperCanvas.id="UpperCanvas",this._updateUpperCanvas(),document.body.appendChild(this._upperCanvas)},Graphics._updateUpperCanvas=function(){this._upperCanvas.width=this._width,this._upperCanvas.height=this._height,this._upperCanvas.style.zIndex=3,this._centerElement(this._upperCanvas)},Graphics._clearUpperCanvas=function(){this._upperCanvas.getContext("2d").clearRect(0,0,this._width,this._height)},Graphics._paintUpperCanvas=function(){if(this._clearUpperCanvas(),this._loadingImage&&this._loadingCount>=20){var t=this._upperCanvas.getContext("2d"),e=(this._width-this._loadingImage.width)/2,i=(this._height-this._loadingImage.height)/2,n=((this._loadingCount-20)/30).clamp(0,1);t.save(),t.globalAlpha=n,t.drawImage(this._loadingImage,e,i),t.restore()}},Graphics._createRenderer=function(){PIXI.dontSayHello=!0;var t=this._width,e=this._height,i={view:this._canvas};try{switch(this._rendererType){case"canvas":this._renderer=new PIXI.CanvasRenderer(t,e,i);break;case"webgl":this._renderer=new PIXI.WebGLRenderer(t,e,i);break;default:this._renderer=PIXI.autoDetectRenderer(t,e,i)}}catch(t){this._renderer=null}},Graphics._updateRenderer=function(){this._renderer&&this._renderer.resize(this._width,this._height)},Graphics._createFPSMeter=function(){this._fpsMeter=new FPSMeter({graph:1,decimals:0,theme:"transparent",toggleOn:null}),this._fpsMeter.hide()},Graphics._createModeBox=function(){var t=document.createElement("div");t.id="modeTextBack",t.style.position="absolute",t.style.left="5px",t.style.top="5px",t.style.width="119px",t.style.height="58px",t.style.background="rgba(0,0,0,0.2)",t.style.zIndex=9,t.style.opacity=0;var e=document.createElement("div");e.id="modeText",e.style.position="absolute",e.style.left="0px",e.style.top="41px",e.style.width="119px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.color="white",e.style.textAlign="center",e.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)",e.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode",document.body.appendChild(t),t.appendChild(e),this._modeBox=t},Graphics._createGameFontLoader=function(){this._createFontLoader("GameFont")},Graphics._createFontLoader=function(t){var e=document.createElement("div"),i=document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(i),document.body.appendChild(e)},Graphics._centerElement=function(t){var e=t.width*this._realScale,i=t.height*this._realScale;t.style.position="absolute",t.style.margin="auto",t.style.top=0,t.style.left=0,t.style.right=0,t.style.bottom=0,t.style.width=e+"px",t.style.height=i+"px"},Graphics._disableTextSelection=function(){var t=document.body;t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.mozUserSelect="none"},Graphics._disableContextMenu=function(){for(var t=document.body.getElementsByTagName("*"),e=function(){return!1},i=0;i<t.length;i++)t[i].oncontextmenu=e},Graphics._applyCanvasFilter=function(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")},Graphics._onVideoLoad=function(){this._video.play(),this._updateVisibility(!0)},Graphics._onVideoError=function(){this._updateVisibility(!1)},Graphics._onVideoEnd=function(){this._updateVisibility(!1)},Graphics._updateVisibility=function(t){this._video.style.opacity=t?1:0,this._canvas.style.opacity=t?0:1},Graphics._isVideoVisible=function(){return this._video.style.opacity>0},Graphics._setupEventHandlers=function(){window.addEventListener("resize",this._onWindowResize.bind(this)),document.addEventListener("keydown",this._onKeyDown.bind(this))},Graphics._onWindowResize=function(){this._updateAllElements()},Graphics._onKeyDown=function(t){if(!t.ctrlKey&&!t.altKey)switch(t.keyCode){case 113:t.preventDefault(),this._switchFPSMeter();break;case 114:t.preventDefault(),this._switchStretchMode();break;case 115:t.preventDefault(),this._switchFullScreen()}},Graphics._switchFPSMeter=function(){this._fpsMeter.isPaused?(this.showFps(),this._fpsMeter.showFps(),this._fpsMeterToggled=!1):this._fpsMeterToggled?this.hideFps():(this._fpsMeter.showDuration(),this._fpsMeterToggled=!0)},Graphics._switchStretchMode=function(){this._stretchEnabled=!this._stretchEnabled,this._updateAllElements()},Graphics._switchFullScreen=function(){this._isFullScreen()?this._requestFullScreen():this._cancelFullScreen()},Graphics._isFullScreen=function(){return document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitFullscreenElement&&!document.msFullscreenElement},Graphics._requestFullScreen=function(){var t=document.body;t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()},Graphics._cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},Input.initialize=function(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()},Input.keyRepeatWait=24,Input.keyRepeatInterval=6,Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"},Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"},Input.clear=function(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._pressedTime=0,this._dir4=0,this._dir8=0,this._preferredAxis="",this._date=0},Input.update=function(){for(var t in this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null,this._currentState)this._currentState[t]&&!this._previousState[t]&&(this._latestButton=t,this._pressedTime=0,this._date=Date.now()),this._previousState[t]=this._currentState[t];this._updateDirection()},Input.isPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isPressed("escape"))||!!this._currentState[t]},Input.isTriggered=function(t){return!(!this._isEscapeCompatible(t)||!this.isTriggered("escape"))||this._latestButton===t&&0===this._pressedTime},Input.isRepeated=function(t){return!(!this._isEscapeCompatible(t)||!this.isRepeated("escape"))||this._latestButton===t&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval==0)},Input.isLongPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isLongPressed("escape"))||this._latestButton===t&&this._pressedTime>=this.keyRepeatWait},Object.defineProperty(Input,"dir4",{get:function(){return this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get:function(){return this._dir8},configurable:!0}),Object.defineProperty(Input,"date",{get:function(){return this._date},configurable:!0}),Input._wrapNwjsAlert=function(){if(Utils.isNwjs()){var t=window.alert;window.alert=function(){var e=require("nw.gui").Window.get();t.apply(this,arguments),e.focus(),Input.clear()}}},Input._setupEventHandlers=function(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))},Input._onKeyDown=function(t){this._shouldPreventDefault(t.keyCode)&&t.preventDefault(),144===t.keyCode&&this.clear();var e=this.keyMapper[t.keyCode];e&&(this._currentState[e]=!0)},Input._shouldPreventDefault=function(t){switch(t){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1},Input._onKeyUp=function(t){var e=this.keyMapper[t.keyCode];e&&(this._currentState[e]=!1),0===t.keyCode&&this.clear()},Input._onLostFocus=function(){this.clear()},Input._pollGamepads=function(){if(navigator.getGamepads){var t=navigator.getGamepads();if(t)for(var e=0;e<t.length;e++){var i=t[e];i&&i.connected&&this._updateGamepadState(i)}}},Input._updateGamepadState=function(t){for(var e=this._gamepadStates[t.index]||[],i=[],n=t.buttons,s=t.axes,r=.5,o=0;o<n.length;o++)i[o]=n[o].pressed;s[1]<-.5?i[12]=!0:s[1]>r&&(i[13]=!0),s[0]<-.5?i[14]=!0:s[0]>r&&(i[15]=!0);for(var a=0;a<i.length;a++)if(i[a]!==e[a]){var h=this.gamepadMapper[a];h&&(this._currentState[h]=i[a])}this._gamepadStates[t.index]=i},Input._updateDirection=function(){var t=this._signX(),e=this._signY();this._dir8=this._makeNumpadDirection(t,e),0!==t&&0!==e?"x"===this._preferredAxis?e=0:t=0:0!==t?this._preferredAxis="y":0!==e&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(t,e)},Input._signX=function(){var t=0;return this.isPressed("left")&&t--,this.isPressed("right")&&t++,t},Input._signY=function(){var t=0;return this.isPressed("up")&&t--,this.isPressed("down")&&t++,t},Input._makeNumpadDirection=function(t,e){return 0!==t||0!==e?5-3*e+t:0},Input._isEscapeCompatible=function(t){return"cancel"===t||"menu"===t},TouchInput.initialize=function(){this.clear(),this._setupEventHandlers()},TouchInput.keyRepeatWait=24,TouchInput.keyRepeatInterval=6,TouchInput.clear=function(){this._mousePressed=!1,this._screenPressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._triggered=!1,this._cancelled=!1,this._moved=!1,this._released=!1,this._wheelX=0,this._wheelY=0,this._x=0,this._y=0,this._date=0},TouchInput.update=function(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++},TouchInput.isPressed=function(){return this._mousePressed||this._screenPressed},TouchInput.isTriggered=function(){return this._triggered},TouchInput.isRepeated=function(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval==0)},TouchInput.isLongPressed=function(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait},TouchInput.isCancelled=function(){return this._cancelled},TouchInput.isMoved=function(){return this._moved},TouchInput.isReleased=function(){return this._released},Object.defineProperty(TouchInput,"wheelX",{get:function(){return this._wheelX},configurable:!0}),Object.defineProperty(TouchInput,"wheelY",{get:function(){return this._wheelY},configurable:!0}),Object.defineProperty(TouchInput,"x",{get:function(){return this._x},configurable:!0}),Object.defineProperty(TouchInput,"y",{get:function(){return this._y},configurable:!0}),Object.defineProperty(TouchInput,"date",{get:function(){return this._date},configurable:!0}),TouchInput._setupEventHandlers=function(){document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this)),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("touchmove",this._onTouchMove.bind(this)),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this))},TouchInput._onMouseDown=function(t){0===t.button?this._onLeftButtonDown(t):1===t.button?this._onMiddleButtonDown(t):2===t.button&&this._onRightButtonDown(t)},TouchInput._onLeftButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(e,i))},TouchInput._onMiddleButtonDown=function(t){},TouchInput._onRightButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&this._onCancel(e,i)},TouchInput._onMouseMove=function(t){if(this._mousePressed){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this._onMove(e,i)}},TouchInput._onMouseUp=function(t){if(0===t.button){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this._mousePressed=!1,this._onRelease(e,i)}},TouchInput._onWheel=function(t){this._events.wheelX+=t.deltaX,this._events.wheelY+=t.deltaY,t.preventDefault()},TouchInput._onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);Graphics.isInsideCanvas(n,s)&&(this._screenPressed=!0,this._pressedTime=0,t.touches.length>=2?this._onCancel(n,s):this._onTrigger(n,s),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()},TouchInput._onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);this._onMove(n,s)}},TouchInput._onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);this._screenPressed=!1,this._onRelease(n,s)}},TouchInput._onTouchCancel=function(t){this._screenPressed=!1},TouchInput._onPointerDown=function(t){if("touch"===t.pointerType&&!t.isPrimary){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._onCancel(e,i),t.preventDefault())}},TouchInput._onTrigger=function(t,e){this._events.triggered=!0,this._x=t,this._y=e,this._date=Date.now()},TouchInput._onCancel=function(t,e){this._events.cancelled=!0,this._x=t,this._y=e},TouchInput._onMove=function(t,e){this._events.moved=!0,this._x=t,this._y=e},TouchInput._onRelease=function(t,e){this._events.released=!0,this._x=t,this._y=e},Sprite.prototype=Object.create(PIXI.Sprite.prototype),Sprite.prototype.constructor=Sprite,Sprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,e),this._bitmap=null,this._frame=new Rectangle,this._realFrame=new Rectangle,this._offset=new Point,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._canvas=null,this._context=null,this._tintTexture=null,this.spriteId=Sprite._counter++,this.opaque=!1,this.bitmap=t},Sprite._counter=0,Object.defineProperty(Sprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&(this._bitmap=t,this._bitmap?(this.setFrame(0,0,0,0),this._bitmap.addLoadListener(this._onBitmapLoad.bind(this))):this.texture.setFrame(Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(Sprite.prototype,"width",{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"height",{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Sprite.prototype.update=function(){this.children.forEach((function(t){t.update&&t.update()}))},Sprite.prototype.move=function(t,e){this.x=t,this.y=e},Sprite.prototype.setFrame=function(t,e,i,n){var s=this._frame;t===s.x&&e===s.y&&i===s.width&&n===s.height||(s.x=t,s.y=e,s.width=i,s.height=n,this._refresh())},Sprite.prototype.getBlendColor=function(){return this._blendColor.clone()},Sprite.prototype.setBlendColor=function(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._blendColor.equals(t)||(this._blendColor=t.clone(),this._refresh())},Sprite.prototype.getColorTone=function(){return this._colorTone.clone()},Sprite.prototype.setColorTone=function(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._colorTone.equals(t)||(this._colorTone=t.clone(),this._refresh())},Sprite.prototype._onBitmapLoad=function(){0===this._frame.width&&0===this._frame.height&&(this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()},Sprite.prototype._refresh=function(){var t=Math.floor(this._frame.x),e=Math.floor(this._frame.y),i=Math.floor(this._frame.width),n=Math.floor(this._frame.height),s=this._bitmap?this._bitmap.width:0,r=this._bitmap?this._bitmap.height:0,o=t.clamp(0,s),a=e.clamp(0,r),h=(i-o+t).clamp(0,s-o),p=(n-a+e).clamp(0,r-a);this._realFrame.x=o,this._realFrame.y=a,this._realFrame.width=h,this._realFrame.height=p,this._offset.x=o-t,this._offset.y=a-e,h>0&&p>0?this._needsTint()?(this._createTinter(h,p),this._executeTint(o,a,h,p),this._tintTexture.dirty(),this.texture.baseTexture=this._tintTexture,this.texture.setFrame(new Rectangle(0,0,h,p))):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.setFrame(this._realFrame)):this._bitmap?this.texture.setFrame(Rectangle.emptyRectangle):(this.texture.trim=this._frame,this.texture.setFrame(this._frame),this.texture.trim=null)},Sprite.prototype._isInBitmapRect=function(t,e,i,n){return this._bitmap&&t+i>0&&e+n>0&&t<this._bitmap.width&&e<this._bitmap.height},Sprite.prototype._needsTint=function(){var t=this._colorTone;return t[0]||t[1]||t[2]||t[3]||this._blendColor[3]>0},Sprite.prototype._createTinter=function(t,e){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=t,this._canvas.height=e,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=t,this._tintTexture.height=e,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode},Sprite.prototype._executeTint=function(t,e,i,n){var s=this._context,r=this._colorTone,o=this._blendColor;if(s.globalCompositeOperation="copy",s.drawImage(this._bitmap.canvas,t,e,i,n,0,0,i,n),Graphics.canUseSaturationBlend()){var a=Math.max(0,r[3]);s.globalCompositeOperation="saturation",s.fillStyle="rgba(255,255,255,"+a/255+")",s.fillRect(0,0,i,n)}var h=Math.max(0,r[0]),p=Math.max(0,r[1]),l=Math.max(0,r[2]);if(s.globalCompositeOperation="lighter",s.fillStyle=Utils.rgbToCssColor(h,p,l),s.fillRect(0,0,i,n),Graphics.canUseDifferenceBlend()){s.globalCompositeOperation="difference",s.fillStyle="white",s.fillRect(0,0,i,n);var u=Math.max(0,-r[0]),c=Math.max(0,-r[1]),d=Math.max(0,-r[2]);s.globalCompositeOperation="lighter",s.fillStyle=Utils.rgbToCssColor(u,c,d),s.fillRect(0,0,i,n),s.globalCompositeOperation="difference",s.fillStyle="white",s.fillRect(0,0,i,n)}var _=Math.max(0,o[0]),f=Math.max(0,o[1]),m=Math.max(0,o[2]),g=Math.max(0,o[3]);s.globalCompositeOperation="source-atop",s.fillStyle=Utils.rgbToCssColor(_,f,m),s.globalAlpha=g/255,s.fillRect(0,0,i,n),s.globalCompositeOperation="destination-in",s.globalAlpha=1,s.drawImage(this._bitmap.canvas,t,e,i,n,0,0,i,n)},Sprite.prototype.updateTransform=function(){PIXI.Sprite.prototype.updateTransform.call(this),this.worldTransform.tx+=this._offset.x,this.worldTransform.ty+=this._offset.y},Sprite.prototype._renderCanvas=function(t){if(this.visible&&this.alpha>0)if(this.texture.crop.width<=0||this.texture.crop.height<=0){this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;e<i;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}else PIXI.Sprite.prototype._renderCanvas.call(this,t)},Sprite.prototype._renderWebGL=function(t){if(this.visible&&this.alpha>0){var e=t.spriteBatch;this._filters&&(e.flush(),t.filterManager.pushFilter(this._filterBlock),this.opaque&&(t.gl.clearColor(0,0,0,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT))),this._mask&&(e.stop(),t.maskManager.pushMask(this.mask,t),e.start()),e.render(this);for(var i=0,n=this.children.length;i<n;i++)this.children[i]._renderWebGL(t);this._mask&&(e.stop(),t.maskManager.popMask(this._mask,t),e.start()),this._filters&&(e.stop(),t.filterManager.popFilter(),e.start())}},Tilemap.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._margin=20,this._width=Graphics.width+2*this._margin,this._height=Graphics.height+2*this._margin,this._tileWidth=48,this._tileHeight=48,this._mapWidth=0,this._mapHeight=0,this._mapData=null,this._layerWidth=0,this._layerHeight=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Point,this.flags=[],this.animationCount=0,this.horizontalWrap=!1,this.verticalWrap=!1,this._createLayers(),this.refresh()},Object.defineProperty(Tilemap.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(t){this._tileWidth!==t&&(this._tileWidth=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(t){this._tileHeight!==t&&(this._tileHeight=t,this._createLayers())}}),Tilemap.prototype.setData=function(t,e,i){this._mapWidth=t,this._mapHeight=e,this._mapData=i},Tilemap.prototype.isReady=function(){for(var t=0;t<this.bitmaps.length;t++)if(this.bitmaps[t]&&!this.bitmaps[t].isReady())return!1;return!0},Tilemap.prototype.update=function(){this.animationCount++,this.children.forEach((function(t){t.update&&t.update()}))},Tilemap.prototype.refresh=function(){this._lastTiles.length=0},Tilemap.prototype.updateTransform=function(){var t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),n=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,n),this._paintAllTiles(i,n),this._sortChildren(),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Tilemap.prototype._createLayers=function(){var t=this._width,e=this._height,i=this._margin,n=Math.ceil(t/this._tileWidth)+1,s=Math.ceil(e/this._tileHeight)+1,r=n*this._tileWidth,o=s*this._tileHeight;this._lowerBitmap=new Bitmap(r,o),this._upperBitmap=new Bitmap(r,o),this._layerWidth=r,this._layerHeight=o,this._lowerLayer=new Sprite,this._lowerLayer.move(-i,-i,t,e),this._lowerLayer.z=0,this._upperLayer=new Sprite,this._upperLayer.move(-i,-i,t,e),this._upperLayer.z=4;for(var a=0;a<4;a++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)},Tilemap.prototype._updateLayerPositions=function(t,e){for(var i=this._margin,n=Math.floor(this.origin.x),s=Math.floor(this.origin.y),r=(n-i).mod(this._layerWidth),o=(s-i).mod(this._layerHeight),a=this._layerWidth-r,h=this._layerHeight-o,p=this._width-a,l=this._height-h,u=0;u<2;u++){var c;(c=0===u?this._lowerLayer.children:this._upperLayer.children)[0].move(0,0,a,h),c[0].setFrame(r,o,a,h),c[1].move(a,0,p,h),c[1].setFrame(0,o,p,h),c[2].move(0,h,a,l),c[2].setFrame(r,0,a,l),c[3].move(a,h,p,l),c[3].setFrame(0,0,p,l)}},Tilemap.prototype._paintAllTiles=function(t,e){for(var i=Math.ceil(this._width/this._tileWidth)+1,n=Math.ceil(this._height/this._tileHeight)+1,s=0;s<n;s++)for(var r=0;r<i;r++)this._paintTiles(t,e,r,s)},Tilemap.prototype._paintTiles=function(t,e,i,n){var s=t+i,r=e+n,o=(s*this._tileWidth).mod(this._layerWidth),a=(r*this._tileHeight).mod(this._layerHeight),h=o/this._tileWidth,p=a/this._tileHeight,l=this._readMapData(s,r,0),u=this._readMapData(s,r,1),c=this._readMapData(s,r,2),d=this._readMapData(s,r,3),_=this._readMapData(s,r,4),f=this._readMapData(s,r-1,1),m=[],g=[];this._isHigherTile(l)?g.push(l):m.push(l),this._isHigherTile(u)?g.push(u):m.push(u),m.push(-_),this._isTableTile(f)&&!this._isTableTile(u)&&(Tilemap.isShadowingTile(l)||m.push(1e4+f)),this._isOverpassPosition(s,r)?(g.push(c),g.push(d)):(this._isHigherTile(c)?g.push(c):m.push(c),this._isHigherTile(d)?g.push(d):m.push(d));var y=1e3+this.animationCount-r,w=y%30==0;this._animationFrame=Math.floor(y/30);var v=this._readLastTiles(0,h,p);if(!m.equals(v)||Tilemap.isTileA1(l)&&w){this._lowerBitmap.clearRect(o,a,this._tileWidth,this._tileHeight);for(var b=0;b<m.length;b++){var T=m[b];T<0?this._drawShadow(this._lowerBitmap,_,o,a):T>=1e4?this._drawTableEdge(this._lowerBitmap,f,o,a):this._drawTile(this._lowerBitmap,T,o,a)}this._writeLastTiles(0,h,p,m)}var S=this._readLastTiles(1,h,p);if(!g.equals(S)){this._upperBitmap.clearRect(o,a,this._tileWidth,this._tileHeight);for(var A=0;A<g.length;A++)this._drawTile(this._upperBitmap,g[A],o,a);this._writeLastTiles(1,h,p,g)}},Tilemap.prototype._readLastTiles=function(t,e,i){var n=this._lastTiles[t];if(n){var s=n[i];if(s){var r=s[e];if(r)return r}}return[]},Tilemap.prototype._writeLastTiles=function(t,e,i,n){var s=this._lastTiles[t];s||(s=this._lastTiles[t]=[]);var r=s[i];r||(r=s[i]=[]),r[e]=n},Tilemap.prototype._drawTile=function(t,e,i,n){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,n):this._drawNormalTile(t,e,i,n))},Tilemap.prototype._drawNormalTile=function(t,e,i,n){var s=0;s=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);var r=this._tileWidth,o=this._tileHeight,a=(Math.floor(e/128)%2*8+e%8)*r,h=Math.floor(e%256/8)%16*o,p=this.bitmaps[s];p&&t.blt(p,a,h,r,o,i,n,r,o)},Tilemap.prototype._drawAutotile=function(t,e,i,n){var s=Tilemap.FLOOR_AUTOTILE_TABLE,r=Tilemap.getAutotileKind(e),o=Tilemap.getAutotileShape(e),a=r%8,h=Math.floor(r/8),p=0,l=0,u=0,c=!1;if(Tilemap.isTileA1(e)){var d=[0,1,2,1][this._animationFrame%4];u=0,0===r?(p=2*d,l=0):1===r?(p=2*d,l=3):2===r?(p=6,l=0):3===r?(p=6,l=3):(p=8*Math.floor(a/4),l=6*h+Math.floor(a/2)%2*3,r%2==0?p+=2*d:(p+=6,s=Tilemap.WATERFALL_AUTOTILE_TABLE,l+=this._animationFrame%3))}else Tilemap.isTileA2(e)?(u=1,p=2*a,l=3*(h-2),c=this._isTableTile(e)):Tilemap.isTileA3(e)?(u=2,p=2*a,l=2*(h-6),s=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(u=3,p=2*a,l=Math.floor(2.5*(h-10)+(h%2==1?.5:0)),h%2==1&&(s=Tilemap.WALL_AUTOTILE_TABLE));var _=s[o],f=this.bitmaps[u];if(_&&f)for(var m=this._tileWidth/2,g=this._tileHeight/2,y=0;y<4;y++){var w=_[y][0],v=_[y][1],b=(2*p+w)*m,T=(2*l+v)*g,S=i+y%2*m,A=n+Math.floor(y/2)*g;if(!c||1!==v&&5!==v)t.blt(f,b,T,m,g,S,A,m,g);else{var x=w;1===v&&(x=[0,3,2,1][w]);var I=(2*p+x)*m,C=(2*l+3)*g;t.blt(f,I,C,m,g,S,A,m,g),A+=g/2,t.blt(f,b,T,m,g/2,S,A,m,g/2)}}},Tilemap.prototype._drawTableEdge=function(t,e,i,n){if(Tilemap.isTileA2(e)){var s=Tilemap.FLOOR_AUTOTILE_TABLE,r=Tilemap.getAutotileKind(e),o=Tilemap.getAutotileShape(e),a=2*(r%8),h=3*(Math.floor(r/8)-2),p=s[o];if(p)for(var l=this.bitmaps[1],u=this._tileWidth/2,c=this._tileHeight/2,d=0;d<2;d++){var _=(2*a+p[2+d][0])*u,f=(2*h+p[2+d][1])*c+c/2,m=i+d%2*u,g=n+Math.floor(d/2)*c;t.blt(l,_,f,u,c/2,m,g,u,c/2)}}},Tilemap.prototype._drawShadow=function(t,e,i,n){if(15&e)for(var s=this._tileWidth/2,r=this._tileHeight/2,o=0;o<4;o++)if(e&1<<o){var a=i+o%2*s,h=n+Math.floor(o/2)*r;t.fillRect(a,h,s,r,"rgba(0,0,0,0.5)")}},Tilemap.prototype._readMapData=function(t,e,i){if(this._mapData){var n=this._mapWidth,s=this._mapHeight;return this.horizontalWrap&&(t=t.mod(n)),this.verticalWrap&&(e=e.mod(s)),t>=0&&t<n&&e>=0&&e<s&&this._mapData[(i*s+e)*n+t]||0}return 0},Tilemap.prototype._isHigherTile=function(t){return 16&this.flags[t]},Tilemap.prototype._isTableTile=function(t){return Tilemap.isTileA2(t)&&128&this.flags[t]},Tilemap.prototype._isOverpassPosition=function(t,e){return!1},Tilemap.prototype._sortChildren=function(){this.children.sort(this._compareChildOrder.bind(this))},Tilemap.prototype._compareChildOrder=function(t,e){return t.z!==e.z?t.z-e.z:t.y!==e.y?t.y-e.y:t.spriteId-e.spriteId},Tilemap.TILE_ID_B=0,Tilemap.TILE_ID_C=256,Tilemap.TILE_ID_D=512,Tilemap.TILE_ID_E=768,Tilemap.TILE_ID_A5=1536,Tilemap.TILE_ID_A1=2048,Tilemap.TILE_ID_A2=2816,Tilemap.TILE_ID_A3=4352,Tilemap.TILE_ID_A4=5888,Tilemap.TILE_ID_MAX=8192,Tilemap.isVisibleTile=function(t){return t>0&&t<this.TILE_ID_MAX},Tilemap.isAutotile=function(t){return t>=this.TILE_ID_A1},Tilemap.getAutotileKind=function(t){return Math.floor((t-this.TILE_ID_A1)/48)},Tilemap.getAutotileShape=function(t){return(t-this.TILE_ID_A1)%48},Tilemap.makeAutotileId=function(t,e){return this.TILE_ID_A1+48*t+e},Tilemap.isSameKindTile=function(t,e){return this.isAutotile(t)&&this.isAutotile(e)?this.getAutotileKind(t)===this.getAutotileKind(e):t===e},Tilemap.isTileA1=function(t){return t>=this.TILE_ID_A1&&t<this.TILE_ID_A2},Tilemap.isTileA2=function(t){return t>=this.TILE_ID_A2&&t<this.TILE_ID_A3},Tilemap.isTileA3=function(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4},Tilemap.isTileA4=function(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX},Tilemap.isTileA5=function(t){return t>=this.TILE_ID_A5&&t<this.TILE_ID_A1},Tilemap.isWaterTile=function(t){return!!this.isTileA1(t)&&!(t>=this.TILE_ID_A1+96&&t<this.TILE_ID_A1+192)},Tilemap.isWaterfallTile=function(t){return t>=this.TILE_ID_A1+192&&t<this.TILE_ID_A2&&this.getAutotileKind(t)%2==1},Tilemap.isGroundTile=function(t){return this.isTileA1(t)||this.isTileA2(t)||this.isTileA5(t)},Tilemap.isShadowingTile=function(t){return this.isTileA3(t)||this.isTileA4(t)},Tilemap.isRoofTile=function(t){return this.isTileA3(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallTopTile=function(t){return this.isTileA4(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallSideTile=function(t){return(this.isTileA3(t)||this.isTileA4(t))&&getAutotileKind(t)%16>=8},Tilemap.isWallTile=function(t){return this.isWallTopTile(t)||this.isWallSideTile(t)},Tilemap.isFloorTypeAutotile=function(t){return this.isTileA1(t)&&!this.isWaterfallTile(t)||this.isTileA2(t)||this.isWallTopTile(t)},Tilemap.isWallTypeAutotile=function(t){return this.isRoofTile(t)||this.isWallSideTile(t)},Tilemap.isWaterfallTypeAutotile=function(t){return this.isWaterfallTile(t)},Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]],TilingSprite.prototype=Object.create(PIXI.TilingSprite.prototype),TilingSprite.prototype.constructor=TilingSprite,TilingSprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.TilingSprite.call(this,e),this._bitmap=null,this._width=0,this._height=0,this._frame=new Rectangle,this.origin=new Point,this.bitmap=t},Object.defineProperty(TilingSprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&(this._bitmap=t,this._bitmap?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.setFrame(Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(TilingSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),TilingSprite.prototype.update=function(){this.children.forEach((function(t){t.update&&t.update()}))},TilingSprite.prototype.move=function(t,e,i,n){this.x=t||0,this.y=e||0,this._width=i||0,this._height=n||0},TilingSprite.prototype.setFrame=function(t,e,i,n){this._frame.x=t,this._frame.y=e,this._frame.width=i,this._frame.height=n,this._refresh()},TilingSprite.prototype.updateTransform=function(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.tilingTexture||(this.originalTexture=null,this.generateTilingTexture(!0)),PIXI.TilingSprite.prototype.updateTransform.call(this)},TilingSprite.prototype._onBitmapLoad=function(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()},TilingSprite.prototype._refresh=function(){var t=this._frame.clone();0===t.width&&0===t.height&&this._bitmap&&(t.width=this._bitmap.width,t.height=this._bitmap.height);var e=this.texture.trim;this.texture.trim=t,this.texture.setFrame(t),this.texture.trim=e,this.tilingTexture=null},ScreenSprite.prototype=Object.create(PIXI.Sprite.prototype),ScreenSprite.prototype.constructor=ScreenSprite,ScreenSprite.prototype.initialize=function(){var t=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,t),this._bitmap=new Bitmap(1,1),this.texture.baseTexture=this._bitmap.baseTexture,this.texture.setFrame(new Rectangle(0,0,1,1)),this.scale.x=Graphics.width,this.scale.y=Graphics.height,this.opacity=0,this._red=-1,this._green=-1,this._blue=-1,this._colorText="",this.setBlack()},Object.defineProperty(ScreenSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),ScreenSprite.prototype.setBlack=function(){this.setColor(0,0,0)},ScreenSprite.prototype.setWhite=function(){this.setColor(255,255,255)},ScreenSprite.prototype.setColor=function(t,e,i){this._red===t&&this._green===e&&this._blue===i||(t=Math.round(t||0).clamp(0,255),e=Math.round(e||0).clamp(0,255),i=Math.round(i||0).clamp(0,255),this._red=t,this._green=e,this._blue=i,this._colorText=Utils.rgbToCssColor(t,e,i),this._bitmap.fillAll(this._colorText))},ScreenSprite.prototype._renderCanvas=function(t){if(this.visible&&this.alpha>0){var e=t.context,i=this.worldTransform,n=t.resolution;e.setTransform(i.a,i.b,i.c,i.d,i.tx*n,i.ty*n),e.globalCompositeOperation=PIXI.blendModesCanvas[this.blendMode],e.globalAlpha=this.alpha,e.fillStyle=this._colorText,e.fillRect(0,0,Graphics.width,Graphics.height)}},Window.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Window.prototype.constructor=Window,Window.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._isWindow=!0,this._windowskin=null,this._width=0,this._height=0,this._cursorRect=new Rectangle,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowSpriteContainer=null,this._windowBackSprite=null,this._windowCursorSprite=null,this._windowFrameSprite=null,this._windowContentsSprite=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Point,this.active=!0,this.downArrowVisible=!1,this.upArrowVisible=!1,this.pause=!1},Object.defineProperty(Window.prototype,"windowskin",{get:function(){return this._windowskin},set:function(t){this._windowskin!==t&&(this._windowskin=t,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))},configurable:!0}),Object.defineProperty(Window.prototype,"contents",{get:function(){return this._windowContentsSprite.bitmap},set:function(t){this._windowContentsSprite.bitmap=t},configurable:!0}),Object.defineProperty(Window.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"opacity",{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"backOpacity",{get:function(){return 255*this._windowBackSprite.alpha},set:function(t){this._windowBackSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"contentsOpacity",{get:function(){return 255*this._windowContentsSprite.alpha},set:function(t){this._windowContentsSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"openness",{get:function(){return this._openness},set:function(t){this._openness!==t&&(this._openness=t.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))},configurable:!0}),Window.prototype.update=function(){this.active&&this._animationCount++,this.children.forEach((function(t){t.update&&t.update()}))},Window.prototype.move=function(t,e,i,n){this.x=t||0,this.y=e||0,this._width===i&&this._height===n||(this._width=i||0,this._height=n||0,this._refreshAllParts())},Window.prototype.isOpen=function(){return this._openness>=255},Window.prototype.isClosed=function(){return this._openness<=0},Window.prototype.setCursorRect=function(t,e,i,n){var s=Math.floor(t||0),r=Math.floor(e||0),o=Math.floor(i||0),a=Math.floor(n||0),h=this._cursorRect;h.x===s&&h.y===r&&h.width===o&&h.height===a||(this._cursorRect.x=s,this._cursorRect.y=r,this._cursorRect.width=o,this._cursorRect.height=a,this._refreshCursor())},Window.prototype.setTone=function(t,e,i){var n=this._colorTone;t===n[0]&&e===n[1]&&i===n[2]||(this._colorTone=[t,e,i],this._refreshBack())},Window.prototype.addChildToBack=function(t){var e=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(t,e+1)},Window.prototype.updateTransform=function(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Window.prototype._createAllParts=function(){this._windowSpriteContainer=new PIXI.DisplayObjectContainer,this._windowBackSprite=new Sprite,this._windowCursorSprite=new Sprite,this._windowFrameSprite=new Sprite,this._windowContentsSprite=new Sprite,this._downArrowSprite=new Sprite,this._upArrowSprite=new Sprite,this._windowPauseSignSprite=new Sprite,this._windowBackSprite.bitmap=new Bitmap(1,1),this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)},Window.prototype._onWindowskinLoad=function(){this._refreshAllParts()},Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()},Window.prototype._refreshBack=function(){var t=this._margin,e=this._width-2*t,i=this._height-2*t,n=new Bitmap(e,i);if(this._windowBackSprite.bitmap=n,this._windowBackSprite.setFrame(0,0,e,i),this._windowBackSprite.move(t,t),e>0&&i>0&&this._windowskin){var s=96;n.blt(this._windowskin,0,0,s,s,0,0,e,i);for(var r=0;r<i;r+=s)for(var o=0;o<e;o+=s)n.blt(this._windowskin,0,s,s,s,o,r,s,s);var a=this._colorTone;n.adjustTone(a[0],a[1],a[2])}},Window.prototype._refreshFrame=function(){var t=this._width,e=this._height,i=24,n=new Bitmap(t,e);if(this._windowFrameSprite.bitmap=n,this._windowFrameSprite.setFrame(0,0,t,e),t>0&&e>0&&this._windowskin){var s=this._windowskin;n.blt(s,120,0,48,i,i,0,t-48,i),n.blt(s,120,72,48,i,i,e-i,t-48,i),n.blt(s,96,24,i,48,0,i,i,e-48),n.blt(s,168,24,i,48,t-i,i,i,e-48),n.blt(s,96,0,i,i,0,0,i,i),n.blt(s,168,0,i,i,t-i,0,i,i),n.blt(s,96,72,i,i,0,e-i,i,i),n.blt(s,168,72,i,i,t-i,e-i,i,i)}},Window.prototype._refreshCursor=function(){var t=this._padding,e=this._cursorRect.x+t-this.origin.x,i=this._cursorRect.y+t-this.origin.y,n=this._cursorRect.width,s=this._cursorRect.height,r=Math.max(e,t),o=Math.max(i,t),a=e-r,h=i-o,p=Math.min(n,this._width-t-r),l=Math.min(s,this._height-t-o),u=new Bitmap(p,l);if(this._windowCursorSprite.bitmap=u,this._windowCursorSprite.setFrame(0,0,p,l),this._windowCursorSprite.move(r,o),n>0&&s>0&&this._windowskin){var c=this._windowskin;u.blt(c,100,100,40,40,a+4,h+4,n-8,s-8),u.blt(c,100,96,40,4,a+4,h+0,n-8,4),u.blt(c,100,140,40,4,a+4,h+s-4,n-8,4),u.blt(c,96,100,4,40,a+0,h+4,4,s-8),u.blt(c,140,100,4,40,a+n-4,h+4,4,s-8),u.blt(c,96,96,4,4,a+0,h+0,4,4),u.blt(c,140,96,4,4,a+n-4,h+0,4,4),u.blt(c,96,140,4,4,a+0,h+s-4,4,4),u.blt(c,140,140,4,4,a+n-4,h+s-4,4,4)}},Window.prototype._refreshContents=function(){this._windowContentsSprite.move(this.padding,this.padding)},Window.prototype._refreshArrows=function(){var t=this._width,e=this._height,i=24,n=12;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(132,60,i,n),this._downArrowSprite.move(t/2,e-n),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(132,24,i,n),this._upArrowSprite.move(t/2,n)},Window.prototype._refreshPauseSign=function(){this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(144,96,24,24),this._windowPauseSignSprite.alpha=0},Window.prototype._updateCursor=function(){var t=this._animationCount%40,e=this.contentsOpacity;this.active&&(e-=t<20?8*t:8*(40-t)),this._windowCursorSprite.alpha=e/255,this._windowCursorSprite.visible=this.isOpen()},Window.prototype._updateContents=function(){var t=this._width-2*this._padding,e=this._height-2*this._padding;t>0&&e>0?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,t,e),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1},Window.prototype._updateArrows=function(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible},Window.prototype._updatePauseSign=function(){var t=this._windowPauseSignSprite,e=Math.floor(this._animationCount/16)%2,i=Math.floor(this._animationCount/16/2)%2;this.pause?t.alpha<1&&(t.alpha=Math.min(t.alpha+.1,1)):t.alpha=0,t.setFrame(144+24*e,96+24*i,24,24),t.visible=this.isOpen()},WindowLayer.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),WindowLayer.prototype.constructor=WindowLayer,WindowLayer.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._width=0,this._height=0,this._tempCanvas=null,this._vertexBuffer=null,this._translationMatrix=[1,0,0,0,1,0,0,0,1],this._dummySprite=new Sprite(new Bitmap(1,1))},Object.defineProperty(WindowLayer.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},configurable:!0}),Object.defineProperty(WindowLayer.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},configurable:!0}),WindowLayer.prototype.move=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},WindowLayer.prototype.update=function(){this.children.forEach((function(t){t.update&&t.update()}))},WindowLayer.prototype._renderCanvas=function(t){if(this.visible){this._tempCanvas||(this._tempCanvas=document.createElement("canvas")),this._tempCanvas.width=Graphics.width,this._tempCanvas.height=Graphics.height;var e=t.context,i=this._tempCanvas.getContext("2d");i.save(),i.clearRect(0,0,Graphics.width,Graphics.height),i.beginPath(),i.rect(this.x,this.y,this.width,this.height),i.closePath(),i.clip(),t.context=i;for(var n=0;n<this.children.length;n++){var s=this.children[n];s._isWindow&&s.visible&&s.openness>0&&(this._canvasClearWindowRect(t,s),i.save(),s._renderCanvas(t),i.restore())}i.restore(),t.context=e,t.context.setTransform(1,0,0,1,0,0),t.context.globalCompositeOperation="source-over",t.context.globalAlpha=1,t.context.drawImage(this._tempCanvas,0,0);for(var r=0;r<this.children.length;r++)this.children[r]._isWindow||this.children[r]._renderCanvas(t)}},WindowLayer.prototype._canvasClearWindowRect=function(t,e){var i=this.x+e.x,n=this.y+e.y+e.height/2*(1-e._openness/255),s=e.width,r=e.height*e._openness/255;t.context.clearRect(i,n,s,r)},WindowLayer.prototype._renderWebGL=function(t){if(this.visible){var e=t.gl;this._vertexBuffer||(this._vertexBuffer=e.createBuffer()),this._dummySprite._renderWebGL(t),t.spriteBatch.stop(),e.enable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),this._webglMaskOutside(t),t.spriteBatch.start();for(var i=this.children.length-1;i>=0;i--){var n=this.children[i];n._isWindow&&n.visible&&n.openness>0&&(e.stencilFunc(e.EQUAL,0,255),n._renderWebGL(t),t.spriteBatch.stop(),this._webglMaskWindow(t,n),t.spriteBatch.start())}e.disable(e.STENCIL_TEST);for(var s=0;s<this.children.length;s++)this.children[s]._isWindow||this.children[s]._renderWebGL(t)}},WindowLayer.prototype._webglMaskOutside=function(t){var e=this.x,i=this.y,n=this.x+this.width,s=this.y+this.height;this._webglMaskRect(t,0,0,Graphics.width,i),this._webglMaskRect(t,0,s,Graphics.width,Graphics.height-s),this._webglMaskRect(t,0,0,e,Graphics.height),this._webglMaskRect(t,n,0,Graphics.width-n,Graphics.height)},WindowLayer.prototype._webglMaskWindow=function(t,e){var i=this.x+e.x,n=this.y+e.y+e.height/2*(1-e._openness/255),s=e.width,r=e.height*e._openness/255;this._webglMaskRect(t,i,n,s,r)},WindowLayer.prototype._webglMaskRect=function(t,e,i,n,s){if(n>0&&s>0){var r=t.gl,o=t.projection,a=t.offset,h=t.shaderManager.primitiveShader;t.shaderManager.setShader(h),r.uniformMatrix3fv(h.translationMatrix,!1,this._translationMatrix),r.uniform1f(h.flipY,1),r.uniform2f(h.projectionVector,o.x,-o.y),r.uniform2f(h.offsetVector,-a.x,-a.y),r.stencilFunc(r.EQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR);var p=new Float32Array([e,i,e+n,i,e,i+s,e,i+s,e+n,i,e+n,i+s]);r.bindBuffer(r.ARRAY_BUFFER,this._vertexBuffer),r.bufferData(r.ARRAY_BUFFER,p,r.STATIC_DRAW),r.enableVertexAttribArray(h.aVertexPosition),r.vertexAttribPointer(h.aVertexPosition,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,6),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},Weather.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Weather.prototype.constructor=Weather,Weather.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._width=Graphics.width,this._height=Graphics.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Point},Weather.prototype.update=function(){this._updateDimmer(),this._updateAllSprites()},Weather.prototype._createBitmaps=function(){this._rainBitmap=new Bitmap(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new Bitmap(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new Bitmap(9,9),this._snowBitmap.drawCircle(4,4,4,"white")},Weather.prototype._createDimmer=function(){this._dimmerSprite=new ScreenSprite,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)},Weather.prototype._updateDimmer=function(){this._dimmerSprite.opacity=Math.floor(6*this.power)},Weather.prototype._updateAllSprites=function(){for(var t=Math.floor(10*this.power);this._sprites.length<t;)this._addSprite();for(;this._sprites.length>t;)this._removeSprite();this._sprites.forEach((function(t){this._updateSprite(t),t.x=t.ax-this.origin.x,t.y=t.ay-this.origin.y}),this)},Weather.prototype._addSprite=function(){var t=new Sprite(this.viewport);t.opacity=0,this._sprites.push(t),this.addChild(t)},Weather.prototype._removeSprite=function(){this.removeChild(this._sprites.pop())},Weather.prototype._updateSprite=function(t){switch(this.type){case"rain":this._updateRainSprite(t);break;case"storm":this._updateStormSprite(t);break;case"snow":this._updateSnowSprite(t)}t.opacity<40&&this._rebornSprite(t)},Weather.prototype._updateRainSprite=function(t){t.bitmap=this._rainBitmap,t.rotation=Math.PI/16,t.ax-=6*Math.sin(t.rotation),t.ay+=6*Math.cos(t.rotation),t.opacity-=6},Weather.prototype._updateStormSprite=function(t){t.bitmap=this._stormBitmap,t.rotation=Math.PI/8,t.ax-=8*Math.sin(t.rotation),t.ay+=8*Math.cos(t.rotation),t.opacity-=8},Weather.prototype._updateSnowSprite=function(t){t.bitmap=this._snowBitmap,t.rotation=Math.PI/16,t.ax-=3*Math.sin(t.rotation),t.ay+=3*Math.cos(t.rotation),t.opacity-=3},Weather.prototype._rebornSprite=function(t){t.ax=Math.randomInt(Graphics.width+100)-100+this.origin.x,t.ay=Math.randomInt(Graphics.height+200)-200+this.origin.y,t.opacity=160+Math.randomInt(60)},ToneFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),ToneFilter.prototype.constructor=ToneFilter,ToneFilter.prototype.initialize=function(){this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},ToneFilter.prototype.reset=function(){this.uniforms.matrix.value=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},ToneFilter.prototype.adjustHue=function(t){if(0!==(t=(t||0)/180)){var e=Math.cos(t*Math.PI),i=Math.sin(t*Math.PI),n=.213+.787*e-.213*i,s=.715-.715*e-.715*i,r=.072-.072*e+.928*i,o=.213-.213*e+.143*i,a=.715+.285*e+.14*i,h=.072-.072*e-.283*i,p=.213-.213*e-.787*i,l=.715-.715*e+.715*i,u=.072+.928*e+.072*i;this._multiplyMatrix([n,s,r,0,o,a,h,0,p,l,u,0,0,0,0,1])}},ToneFilter.prototype.adjustSaturation=function(t){if(0!==(t=(t||0).clamp(-255,255)/255)){var e=1+t,i=.213+.787*e,n=.715-.715*e,s=.072-.072*e,r=.213-.213*e,o=.715+.285*e,a=.072-.072*e,h=.213-.213*e,p=.715-.715*e,l=.072+.928*e;this._multiplyMatrix([i,n,s,0,r,o,a,0,h,p,l,0,0,0,0,1])}},ToneFilter.prototype.adjustTone=function(t,e,i){t=(t||0).clamp(-255,255)/255,e=(e||0).clamp(-255,255)/255,i=(i||0).clamp(-255,255)/255,0===t&&0===e&&0===i||this._multiplyMatrix([1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1])},ToneFilter.prototype._multiplyMatrix=function(t){for(var e=this.uniforms.matrix.value,i=[],n=0;n<4;n++){for(var s=0;s<4;s++)i[s]=e[4*n+s];for(var r=0;r<4;r++){for(var o=0,a=0;a<4;a++)o+=t[4*a+r]*i[a];e[4*n+r]=o}}},ToneSprite.prototype=Object.create(PIXI.DisplayObject.prototype),ToneSprite.prototype.constructor=ToneSprite,ToneSprite.prototype.initialize=function(){PIXI.DisplayObject.call(this),this.clear()},ToneSprite.prototype.clear=function(){this._red=0,this._green=0,this._blue=0,this._gray=0},ToneSprite.prototype.setTone=function(t,e,i,n){this._red=Math.round(t||0).clamp(-255,255),this._green=Math.round(e||0).clamp(-255,255),this._blue=Math.round(i||0).clamp(-255,255),this._gray=Math.round(n||0).clamp(0,255)},ToneSprite.prototype._renderCanvas=function(t){if(this.visible){var e=t.context,i=this.worldTransform,n=t.resolution,s=Graphics.width,r=Graphics.height;e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx*n,i.ty*n),Graphics.canUseSaturationBlend()&&this._gray>0&&(e.globalCompositeOperation="saturation",e.globalAlpha=this._gray/255,e.fillStyle="#ffffff",e.fillRect(0,0,s,r)),e.globalAlpha=1;var o=Math.max(0,this._red),a=Math.max(0,this._green),h=Math.max(0,this._blue);if((o||a||h)&&(e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(o,a,h),e.fillRect(0,0,s,r)),Graphics.canUseDifferenceBlend()){var p=Math.max(0,-this._red),l=Math.max(0,-this._green),u=Math.max(0,-this._blue);(p||l||u)&&(e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,s,r),e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(p,l,u),e.fillRect(0,0,s,r),e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,s,r))}e.restore()}},ToneSprite.prototype._renderWebGL=function(t){},Stage.prototype=Object.create(PIXI.Stage.prototype),Stage.prototype.constructor=Stage,Stage.prototype.initialize=function(){PIXI.Stage.call(this),this.interactive=!1},WebAudio.prototype.initialize=function(t){WebAudio._initialized||WebAudio.initialize(),this.clear(),this._load(t),this._url=t},WebAudio._context=null,WebAudio._masterGainNode=null,WebAudio._initialized=!1,WebAudio._unlocked=!1,WebAudio.initialize=function(t){return this._initialized||(t||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context},WebAudio.canPlayOgg=function(){return this._initialized||this.initialize(),!!this._canPlayOgg},WebAudio.canPlayM4a=function(){return this._initialized||this.initialize(),!!this._canPlayM4a},WebAudio._createContext=function(){try{"undefined"!=typeof AudioContext?this._context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(t){this._context=null}},WebAudio._detectCodecs=function(){var t=document.createElement("audio");t.canPlayType&&(this._canPlayOgg=t.canPlayType("audio/ogg"),this._canPlayM4a=t.canPlayType("audio/mp4"))},WebAudio._createMasterGainNode=function(){var t=WebAudio._context;t&&(this._masterGainNode=t.createGain(),this._masterGainNode.gain.value=1,this._masterGainNode.connect(t.destination))},WebAudio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))},WebAudio._onTouchStart=function(){var t=WebAudio._context;t&&!this._unlocked&&(t.createBufferSource().start(0),this._unlocked=!0)},WebAudio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},WebAudio._onHide=function(){this._shouldMuteOnHide()&&this._fadeOut(1)},WebAudio._onShow=function(){this._shouldMuteOnHide()&&this._fadeIn(.5)},WebAudio._shouldMuteOnHide=function(){return Utils.isMobileDevice()},WebAudio._fadeIn=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(e.value,i),e.linearRampToValueAtTime(1,i+t)}},WebAudio._fadeOut=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(e.value,i),e.linearRampToValueAtTime(0,i+t)}},WebAudio.prototype.clear=function(){this.stop(),this._buffer=null,this._sourceNode=null,this._gainNode=null,this._pannerNode=null,this._totalTime=0,this._sampleRate=0,this._loopStart=0,this._loopLength=0,this._startTime=0,this._volume=1,this._pitch=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._hasError=!1,this._autoPlay=!1},Object.defineProperty(WebAudio.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(WebAudio.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._gainNode&&(this._gainNode.gain.value=this._volume)},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this.isPlaying()&&this.play(this._sourceNode.loop,0))},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._updatePanner()},configurable:!0}),WebAudio.prototype.isReady=function(){return!!this._buffer},WebAudio.prototype.isError=function(){return this._hasError},WebAudio.prototype.isPlaying=function(){return!!this._sourceNode},WebAudio.prototype.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&this.play(t,e)}.bind(this)))},WebAudio.prototype.stop=function(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;this._stopListeners.length>0;){this._stopListeners.shift()()}},WebAudio.prototype.fadeIn=function(t){if(this.isReady()){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._volume,i+t)}}else this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},WebAudio.prototype.fadeOut=function(t){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(e.value,i),e.linearRampToValueAtTime(0,i+t)}this._autoPlay=!1},WebAudio.prototype.seek=function(){if(WebAudio._context){var t=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(this._loopLength>0)for(;t>=this._loopStart+this._loopLength;)t-=this._loopLength;return t}return 0},WebAudio.prototype.addLoadListener=function(t){this._loadListeners.push(t)},WebAudio.prototype.addStopListener=function(t){this._stopListeners.push(t)},WebAudio.prototype._load=function(t){if(WebAudio._context){var e=new XMLHttpRequest;e.open("GET",t),e.responseType="arraybuffer",e.onload=function(){e.status<400&&this._onXhrLoad(e)}.bind(this),e.onerror=function(){this._hasError=!0}.bind(this),e.send()}},WebAudio.prototype._onXhrLoad=function(t){var e=new Uint8Array(t.response);this._readLoopComments(e),WebAudio._context.decodeAudioData(t.response,function(t){this._buffer=t,this._totalTime=t.duration,this._loopLength>0&&this._sampleRate>0?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()}.bind(this))},WebAudio.prototype._startPlaying=function(t,e){this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=t,this._sourceNode.start(0,e),this._startTime=WebAudio._context.currentTime-e/this._pitch,this._createEndTimer()},WebAudio.prototype._createNodes=function(){var t=WebAudio._context;this._sourceNode=t.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.value=this._pitch,this._gainNode=t.createGain(),this._gainNode.gain.value=this._volume,this._pannerNode=t.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()},WebAudio.prototype._connectNodes=function(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(WebAudio._masterGainNode)},WebAudio.prototype._removeNodes=function(){this._sourceNode&&(this._sourceNode.stop(0),this._sourceNode=null,this._gainNode=null,this._pannerNode=null)},WebAudio.prototype._createEndTimer=function(){if(this._sourceNode&&!this._sourceNode.loop){var t=this._startTime+this._totalTime/this._pitch-WebAudio._context.currentTime;this._endTimer=setTimeout(function(){this.stop()}.bind(this),1e3*t)}},WebAudio.prototype._removeEndTimer=function(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)},WebAudio.prototype._updatePanner=function(){if(this._pannerNode){var t=this._pan,e=1-Math.abs(t);this._pannerNode.setPosition(t,0,e)}},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()()}},WebAudio.prototype._readLoopComments=function(t){this._readOgg(t),this._readMp4(t)},WebAudio.prototype._readOgg=function(t){for(var e=0;e<t.length&&"OggS"===this._readFourCharacters(t,e);){e+=26;for(var i=!1,n=t[e++],s=[],r=0;r<n;r++)s.push(t[e++]);for(r=0;r<n;r++){if("vorb"===this._readFourCharacters(t,e+1)){var o=t[e];1===o?this._sampleRate=this._readLittleEndian(t,e+12):3===o&&this._readMetaData(t,e,s[r]),i=!0}e+=s[r]}if(!i)break}},WebAudio.prototype._readMp4=function(t){if("ftyp"===this._readFourCharacters(t,4))for(var e=0;e<t.length;){var i=this._readBigEndian(t,e),n=this._readFourCharacters(t,e+4);if("moov"===n)e+=8;else if("mvhd"===n&&(this._sampleRate=this._readBigEndian(t,e+20)),"udta"!==n&&"meta"!==n||this._readMetaData(t,e,i),e+=i,i<=1)break}},WebAudio.prototype._readMetaData=function(t,e,i){for(var n=e;n<e+i-10;n++)if("LOOP"===this._readFourCharacters(t,n)){for(var s="";t[n]>0;)s+=String.fromCharCode(t[n++]);if(s.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),s.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),"LOOPSTART"==s||"LOOPLENGTH"==s){var r="";for(n+=16;t[n]>0;)r+=String.fromCharCode(t[n++]);"LOOPSTART"==s?this._loopStart=parseInt(r):this._loopLength=parseInt(r)}}},WebAudio.prototype._readLittleEndian=function(t,e){return 16777216*t[e+3]+65536*t[e+2]+256*t[e+1]+t[e+0]},WebAudio.prototype._readBigEndian=function(t,e){return 16777216*t[e+0]+65536*t[e+1]+256*t[e+2]+t[e+3]},WebAudio.prototype._readFourCharacters=function(t,e){for(var i="",n=0;n<4;n++)i+=String.fromCharCode(t[e+n]);return i},Html5Audio._initialized=!1,Html5Audio._unlocked=!1,Html5Audio._audioElement=null,Html5Audio._gainTweenInterval=null,Html5Audio._tweenGain=0,Html5Audio._tweenTargetGain=0,Html5Audio._tweenGainStep=0,Html5Audio._staticSePath=null,Html5Audio.setup=function(t){this._initialized||this.initialize(),this.clear(),this._url=t},Html5Audio.initialize=function(){if(!this._initialized){if(!this._audioElement)try{this._audioElement=new Audio}catch(t){this._audioElement=null}this._audioElement&&this._setupEventHandlers(),this._initialized=!0}return!!this._audioElement},Html5Audio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._audioElement.addEventListener("loadeddata",this._onLoadedData.bind(this)),this._audioElement.addEventListener("error",this._onError.bind(this)),this._audioElement.addEventListener("ended",this._onEnded.bind(this))},Html5Audio._onTouchStart=function(){this._audioElement&&!this._unlocked&&(this._isLoading?(this._load(this._url),this._unlocked=!0):this._staticSePath&&(this._audioElement.src=this._staticSePath,this._audioElement.volume=0,this._audioElement.loop=!1,this._audioElement.play(),this._unlocked=!0))},Html5Audio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},Html5Audio._onLoadedData=function(){this._buffered=!0,this._unlocked&&this._onLoad()},Html5Audio._onError=function(){this._hasError=!0},Html5Audio._onEnded=function(){this._audioElement.loop||this.stop()},Html5Audio._onHide=function(){this._audioElement.volume=0,this._tweenGain=0},Html5Audio._onShow=function(){this.fadeIn(.5)},Html5Audio.clear=function(){this.stop(),this._volume=1,this._loadListeners=[],this._hasError=!1,this._autoPlay=!1,this._isLoading=!1,this._buffered=!1},Html5Audio.setStaticSe=function(t){this._initialized||(this.initialize(),this.clear()),this._staticSePath=t},Object.defineProperty(Html5Audio,"url",{get:function(){return Html5Audio._url},configurable:!0}),Object.defineProperty(Html5Audio,"volume",{get:function(){return Html5Audio._volume}.bind(this),set:function(t){Html5Audio._volume=t,Html5Audio._audioElement&&(Html5Audio._audioElement.volume=this._volume)},configurable:!0}),Html5Audio.isReady=function(){return this._buffered},Html5Audio.isError=function(){return this._hasError},Html5Audio.isPlaying=function(){return!this._audioElement.paused},Html5Audio.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):Html5Audio._audioElement&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&(this.play(t,e),this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null))}.bind(this)),this._isLoading||this._load(this._url))},Html5Audio.stop=function(){this._audioElement&&this._audioElement.pause(),this._autoPlay=!1,this._tweenInterval&&(clearInterval(this._tweenInterval),this._tweenInterval=null,this._audioElement.volume=0)},Html5Audio.fadeIn=function(t){this.isReady()?this._audioElement&&(this._tweenTargetGain=this._volume,this._tweenGain=0,this._startGainTween(t)):this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},Html5Audio.fadeOut=function(t){this._audioElement&&(this._tweenTargetGain=0,this._tweenGain=this._volume,this._startGainTween(t))},Html5Audio.seek=function(){return this._audioElement?this._audioElement.currentTime:0},Html5Audio.addLoadListener=function(t){this._loadListeners.push(t)},Html5Audio._load=function(t){this._audioElement&&(this._isLoading=!0,this._audioElement.src=t,this._audioElement.load())},Html5Audio._startPlaying=function(t,e){this._audioElement.loop=t,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._audioElement&&(this._audioElement.volume=this._volume,this._audioElement.currentTime=e,this._audioElement.play())},Html5Audio._onLoad=function(){for(this._isLoading=!1;this._loadListeners.length>0;){this._loadListeners.shift()()}},Html5Audio._startGainTween=function(t){this._audioElement.volume=this._tweenGain,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._tweenGainStep=(this._tweenTargetGain-this._tweenGain)/(60*t),this._gainTweenInterval=setInterval((function(){Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain)}),1e3/60)},Html5Audio._applyTweenValue=function(t){Html5Audio._tweenGain+=Html5Audio._tweenGainStep,Html5Audio._tweenGain<0&&Html5Audio._tweenGainStep<0?Html5Audio._tweenGain=0:Html5Audio._tweenGain>t&&Html5Audio._tweenGainStep>0&&(Html5Audio._tweenGain=t),Math.abs(Html5Audio._tweenTargetGain-Html5Audio._tweenGain)<.01&&(Html5Audio._tweenGain=Html5Audio._tweenTargetGain,clearInterval(Html5Audio._gainTweenInterval),Html5Audio._gainTweenInterval=null),Html5Audio._audioElement.volume=Html5Audio._tweenGain},JsonEx.maxDepth=100,JsonEx.stringify=function(t){return JSON.stringify(this._encode(t))},JsonEx.parse=function(t){return this._decode(JSON.parse(t))},JsonEx.makeDeepCopy=function(t){return this.parse(this.stringify(t))},JsonEx._encode=function(t,e){if(e=e||0,++e>=this.maxDepth)throw new Error("Object too deep");var i=Object.prototype.toString.call(t);if("[object Object]"===i||"[object Array]"===i){var n=this._getConstructorName(t);for(var s in"Object"!==n&&"Array"!==n&&(t["@"]=n),t)t.hasOwnProperty(s)&&(t[s]=this._encode(t[s],e+1))}return e--,t},JsonEx._decode=function(t){var e=Object.prototype.toString.call(t);if("[object Object]"===e||"[object Array]"===e){if(t["@"]){var i=window[t["@"]];i&&(t=this._resetPrototype(t,i.prototype))}for(var n in t)t.hasOwnProperty(n)&&(t[n]=this._decode(t[n]))}return t},JsonEx._getConstructorName=function(t){var e=t.constructor.name;if(void 0===e){e=/^\s*function\s*([A-Za-z0-9_$]*)/.exec(t.constructor)[1]}return e},JsonEx._resetPrototype=function(t,e){if(void 0!==Object.setPrototypeOf)Object.setPrototypeOf(t,e);else if("__proto__"in t)t.__proto__=e;else{var i=Object.create(e);for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);t=i}return t};